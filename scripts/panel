#!/bin/bash

source ~/.config/global.conf

monitors="`bspc query --monitors | wc -l`"

function statusbar {

    batt() {
        batt_status=$(battery | awk -F' ' '{print $1}')
        batt_level=$(battery | awk -F' ' '{print $2}')
        if [ $batt_status == 'Charging'  ] && [ $batt_level -gt 98 ] ; then
            echo "%{F$BLUE}ÓàÅ%{F-}"
        elif [ $batt_status == 'Charging' ] ; then
            echo "%{F$BLUE}ÓàÄ%{F-}"
        elif [ $batt_level -le 10 ] ; then
            echo "%{F$RED}ÓáΩ%{F-}"
        elif [ $batt_level -lt 50 ] ; then
            echo "%{F$BLUE}Óáæ%{F-}"
        elif [ $batt_level -le 100 ] ; then
            echo "%{F$BLUE}Óáø%{F-}"
        fi
    }

    clock() {
        date=$(/usr/sbin/clock -f "%a, %b %d")
        time=$(/usr/sbin/clock -f "%l:%M %p")
        echo "%{F$BLUE}$date%{F-} $time"
    }

    vol() {
        vol=$(volume | awk -F' ' '{print $1}')
        vol_level=$(volume | awk -F' ' '{print $2}')
        if [ $vol == 'off' ] ; then
            vol="%{F$RED}ÓÅè%{F-}"
        elif [ $vol_level -lt 50 ] ; then
            vol="%{F$BLUE}ÓÅé%{F-}"
        else
            vol="%{F$BLUE}ÓÅê%{F-}"
        fi
        echo $vol
    }

    desktops() {
        desktop="`bspc control --get-status`"
        # bspwm state
        wm_info=""
        IFS=':'
        set -- ${desktop#?}
        while [ $# -gt 0 ] ; do
            item=$1
            case $item in
                M*)
                    # active monitor
                    #if [ $monitors -gt 1 ] ; then
                    #    wm_info="$wm_info %{F$RED}ÓÖä%{F-}  "
                    #fi
                    ;;
                m*)
                    # inactive monitor
                    #if [ $monitors -gt 1 ] ; then
                    #    wm_info="$wm_info %{F$GREY}ÓÖä%{F-}  "
                    #fi
                    ;;
                O*)
                    # focused occupied desktop
                    wm_info="${wm_info} %{U$BLUE}%{+u}ÓÜê%{-u}"
                    ;;
                F*)
                    # focused free desktop
                    wm_info="${wm_info} %{U$BLUE}%{+u}ÓÜê%{-u}"
                    ;;
                U*)
                    # focused urgent desktop
                    wm_info="${wm_info} %{U$RED}%{+u}ÓÜê%{-u}"
                    ;;
                o*)
                    # occupied desktop
                    wm_info="${wm_info} %{U$WHITE}%{+u}  %{-u}"
                    ;;
                f*)
                    # free desktop
                    wm_info="${wm_info} %{U$GREY}%{+u}  %{-u}"
                    ;;
                u*)
                    # urgent desktop
                    wm_info="${wm_info} %{U$RED}%{+u}  %{-u}"
                    ;;
                L*)
                    # layout
                    ;;
            esac
            shift
        done
        printf "%s\n" "${wm_info}"
    }

    networks() {
        LAN_STATE=`cat /sys/class/net/enp0s25/operstate`
        WIFI_STATE=`cat /sys/class/net/wlp3s0/operstate`

        if [ "$LAN_STATE" = "up" ]
        then
            text="%{F$BLUE}ÓÜú%{F-}"
        elif [ "$WIFI_STATE" = "up" ]
        then
            text="%{F$BLUE}Óâú%{F-}"
        else
            text="%{F$RED}ÓÜú%{F-}"
        fi

        network="$text"
        echo $network
    }

    echo " %{F$BLUE}ÓÄé%{F-}$(desktops) %{r}$(networks) $(vol) $(batt) | $(clock) "
}

while true
do
    echo "$(statusbar)"
    sleep 0.5
done | lemonbar -g x15 -f "$FONT1" -f "$FONT2" -B "$BAR_BG" -F "$BAR_FG" -p &
